- set_fact:
    CEPH_VERSION: "17.2.0"
    CODENAME: "focal"  ## this is derived from CEPH_VERSION i.e. debian-{{ CEPH_VERSION }}/dists/<pick_a_codename>/main
    CLUSTER_NAME: "{{ CLUSTER_NAME|default('veritas') }}"
    # FSID: "ca98662e-19f3-47e3-a029-880ff75396ce"  ## generated by the command `uuidgen`
    SECRET: "{{ lookup('hashivault', 'veritas', mount_point='service/ceph', version=2) }}"

- debug:
    msg:
      - "CEPH_VERSION: {{ CEPH_VERSION }}"
      - "CODENAME: {{ CODENAME }}"
      - "CLUSTER_NAME: {{ CLUSTER_NAME }}"
      - "SECRET: {{ SECRET.keys() }}"

- set_fact:
    CNODE: "{{ CNODE|default({}) | combine({item: lookup('dig', '{{ item }}')}) }}"
  with_items: "{{ play_hosts }}"

- set_fact:
    CNODE_INDEX: "{{ lookup('ansible.utils.index_of', '{{ play_hosts }}', 'regex', '{{ inventory_hostname }}') }}"

- debug:
    msg: "{{ CNODE }}"

- include: get_packages.yaml
- include: monitor_bootstrapping.yaml

