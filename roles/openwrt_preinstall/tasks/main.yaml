- block:
  - name: cryptsetup
    package:
      name: cryptsetup

  ## https://openwrt.org/docs/techref/driver.wlan/start
  ## https://www.cyberciti.biz/faq/linux-find-wireless-driver-chipset/
  ## sudo lshw -C network | grep -B 1 -A 12 'Wireless interface'
  - name: network tools
    package:
      name: "{{ item }}"
    loop:
      ## ORDER MATTERS!!!
      - wireless-tools
      - iw-full
      - ip-full
      - iwinfo
      - wpad

  - name: driver tuntap
    package:
      name: "{{ item }}"
    loop:
      - kmod-tun

  - name: wireless drivers Atheros
    package:
      name: "{{ item }}"
    loop:
      - kmod-ath10k
      - kmod-ath3k
      - kmod-ath5k
      - kmod-ath9k

  - name: wireless drivers Ralink
    package:
      name: "{{ item }}"
    loop:
      - kmod-rt2400-pci
      - kmod-rt2500-pci
      - kmod-rt2500-usb
      - kmod-rt2800-lib
      - kmod-rt2800-mmio
      - kmod-rt2800-pci
      - kmod-rt2800-usb
      - kmod-rt2x00-lib
      - kmod-rt2x00-mmio
      - kmod-rt2x00-pci
      - kmod-rt2x00-usb
      - kmod-rt61-pci
      - kmod-rt73-usb

  - name: wireless drivers b43
    package:
      name: "{{ item }}"
    loop:
      - kmod-b43
      - kmod-b43legacy

## these DO work!, but compiling zekenet for openwrt is painful
#  - name: smart card drivers
#    package:
#      name: "{{ item }}"
#    loop:
#      - pcscd
#      - ccid
#      - libopensc-pkcs11
#      - opensc-utils-pkcs11-tool
#      - p11-kit
#      - gnutls-utils

- block:
  - name: install ansible
    pip:
      name:
        - ansible
        - ansible-modules-hashivault

  - name: remove luci
    package:
      name: "{{ item }}"
      state: absent
    loop:
      ## ORDER MATTERS!!!
      - luci-ssl
      - luci
      - luci-app-firewall
      - luci-app-opkg
      - luci-mod-admin-full
      - luci-mod-network
      - luci-mod-status
      - luci-mod-system
      - luci-proto-ipv6
      - luci-proto-ppp
      - luci-theme-bootstrap
      - luci-base
      - luci-lib-base
      - luci-lib-ip
      - luci-lib-jsonc
      - luci-lib-nixio

  - name: remove dropbear
    package:
      name: dropbear
      state: absent
  
  - name: install openssh-server
    package:
      name: "{{ item }}"
    loop:
      - openssh-server
      - openssh-client

  - name: install nice to have packages
    package:
      name: "{{ item }}"
    loop:
      - pv
      - jq
      - git
      - git-http
      - file
      - nano
      - nmap
      - fdisk
      - sgdisk
      - rsync
      - usbutils
      - pciutils
      - iputils-ping

- name: run other roles
  include_role:
    name: "{{ role_other }}"
  loop:
    - pki
    - ssh
  loop_control:
    loop_var: role_other

